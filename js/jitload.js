var OpenSpending=OpenSpending||{};OpenSpending.DatasetPage={View:{},Controller:{},init:function(e){var t=new OpenSpending.DatasetPage.Controller(e);Backbone.history.start();return t}};OpenSpending.DatasetPage.Controller=Backbone.Router.extend({routes:{"":"treemap",treemap:"treemap",timeseries:"timeseries"},initialize:function(e){this.config=e;this.view=new OpenSpending.DatasetPage.View;$("#_vis_select").change(function(e){window.location.hash="#"+e.target.value;return false})},treemap:function(){this.view.renderTreemap(this.config.treemapData)},timeseries:function(){this.view.renderTimeseries(this.config.timeseriesData)}});OpenSpending.DatasetPage.View=Backbone.View.extend({initialize:function(){this.config={};var e=navigator.userAgent,t=e.match(/iPhone/i)||e.match(/iPad/i),n=typeof HTMLCanvasElement,r=n=="object"||n=="function",i=r&&typeof document.createElement("canvas").getContext("2d").fillText=="function";this.config.labelType=!r||i&&!t?"Native":"HTML";this.config.nativeTextSupport=this.config.labelType=="Native";this.config.useGradients=r;this.config.animate=!(t||!r)},renderTreemap:function(e){$("#_vis_select").val("treemap");$("#_time_select").css("visibility","visible");$("#mainvis").html("");this._renderTreemap(e,this.config)},renderTimeseries:function(e){$("#_vis_select").val("timeseries");$("#_time_select").css("visibility","hidden");$("#mainvis").html("");this._renderTimeseries(e,this.config)},_renderTreemap:function(e,t){var n=new $jit.TM.Squarified({injectInto:"mainvis",levelsToShow:1,titleHeight:0,animate:t.animate,offset:2,Label:{type:"HTML",size:12,family:"Tahoma, Verdana, Arial",color:"#DDE7F0"},Node:{color:"#243448",CanvasStyles:{shadowBlur:0,shadowColor:"#000"}},Events:{enable:true,onClick:function(e){if(e){document.location.href=e.data.link}},onRightClick:function(){n.out()},onMouseEnter:function(e,t){if(e){e.setCanvasStyle("shadowBlur",8);e.orig_color=e.getData("color");e.setData("color","#A3B3C7");n.fx.plotNode(e,n.canvas)}},onMouseLeave:function(e){if(e){e.removeData("color");e.removeCanvasStyle("shadowBlur");e.setData("color",e.orig_color);n.plot()}}},duration:1e3,Tips:{enable:true,type:"Native",offsetX:20,offsetY:20,onShow:function(e,t,n,r){var i='<div class="tip-title">'+t.name+": "+t.data.printable_value+'</div><div class="tip-text">';var s=t.data;e.innerHTML=i}},request:function(t,n,r){var i=e;var s=$jit.json.getSubtree(i,t);$jit.json.prune(s,1);r.onComplete(t,s)},onCreateLabel:function(e,t){if(t.data.show_title){e.innerHTML="<div class='desc'><h2>"+t.data.printable_value+"</h2>"+t.name+"</div>"}else{e.innerHTML="Â "}}});n.loadJSON(e);n.refresh()},_renderTimeseries:function(e,t){var n=new $jit.AreaChart({injectInto:"mainvis",levelsToShow:1,titleHeight:0,Margin:{top:5,left:5,right:5,bottom:5},labelOffset:10,animate:t.animate,showLabels:true,Label:{type:"HTML",size:12,family:"Tahoma, Verdana, Arial",color:"#000"},Node:{CanvasStyles:{shadowBlur:0,shadowColor:"#000"}},Events:{enable:true,onClick:function(t){console.log(t);if(t){document.location.href=e.details[t.name].link}},onRightClick:function(){n.out()}},duration:500,Tips:{enable:true,type:"Native",offsetX:20,offsetY:20,onShow:function(t,n){t.innerHTML="<b>"+e.details[n.name].title+"</b>: "+OpenSpending.Utils.formatAmount(n.value)}}});n.colors=e.colors;var r=n.st.config.onPlaceLabel;n.st.config.onPlaceLabel=function(e,t){r(e,t);var n=$($("div >div",e)[1]);if(n){n.text(OpenSpending.Utils.formatAmount(n.text()))}};n.loadJSON(e)}})